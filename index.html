<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Juego de Estad칤stica - Modo Competencia</title>
    <!-- QR Code Generator -->
    <script src="https://cdn.jsdelivr.net/npm/qrcode-generator@1.4.4/qrcode.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
            color: #333;
        }
        .container {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(0,0,0,0.1);
        }
        h1, h2, h3 {
            color: #2c3e50;
            text-align: center;
        }
        .login-container, .admin-panel, .team-selection, .game-container, .results-container {
            display: none;
        }
        .active {
            display: block;
        }
        .question {
            margin-bottom: 20px;
            padding: 15px;
            background-color: #eaf2f8;
            border-radius: 5px;
        }
        .options {
            margin-top: 10px;
        }
        .option {
            margin: 5px 0;
            padding: 10px;
            background-color: #d4e6f1;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .option:hover {
            background-color: #a9cce3;
        }
        .selected {
            background-color: #3498db;
            color: white;
        }
        .correct {
            background-color: #2ecc71;
            color: white;
        }
        .incorrect {
            background-color: #e74c3c;
            color: white;
        }
        .feedback {
            margin-top: 10px;
            padding: 10px;
            border-radius: 5px;
            display: none;
        }
        .buttons {
            margin-top: 20px;
            text-align: center;
        }
        button {
            padding: 10px 20px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 0 5px;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #2980b9;
        }
        button:disabled {
            background-color: #95a5a6;
            cursor: not-allowed;
        }
        .result {
            margin-top: 20px;
            text-align: center;
            font-weight: bold;
            font-size: 1.2em;
        }
        .progress {
            margin-top: 20px;
            height: 20px;
            background-color: #ecf0f1;
            border-radius: 10px;
            overflow: hidden;
        }
        .progress-bar {
            height: 100%;
            background-color: #3498db;
            width: 0%;
            transition: width 0.5s;
        }
        .explanation {
            margin-top: 10px;
            padding: 10px;
            background-color: #f9e79f;
            border-radius: 5px;
            display: none;
        }
        .image-container {
            text-align: center;
            margin: 15px 0;
        }
        .image-container img {
            max-width: 100%;
            border-radius: 5px;
            box-shadow: 0 0 5px rgba(0,0,0,0.2);
        }
        .team-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        .team-card {
            background-color: #fff;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            text-align: center;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .team-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .team-card.selected-team {
            border: 3px solid #3498db;
        }
        .team-name {
            font-weight: bold;
            margin-bottom: 10px;
        }
        .team-score {
            font-size: 1.2em;
            color: #2c3e50;
        }
        .admin-controls {
            margin-top: 20px;
            padding: 15px;
            background-color: #eaf2f8;
            border-radius: 5px;
        }
        .team-progress {
            margin-top: 10px;
            padding: 10px;
            background-color: #f5f5f5;
            border-radius: 5px;
        }
        .qr-container {
            text-align: center;
            margin: 20px 0;
        }
        .input-group {
            margin-bottom: 15px;
        }
        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .input-group input, .input-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .tab-container {
            margin-top: 20px;
        }
        .tab-buttons {
            display: flex;
            border-bottom: 1px solid #ddd;
        }
        .tab-button {
            padding: 10px 20px;
            background-color: #f5f5f5;
            border: none;
            border-radius: 5px 5px 0 0;
            cursor: pointer;
        }
        .tab-button.active {
            background-color: #3498db;
            color: white;
        }
        .tab-content {
            padding: 20px;
            background-color: #fff;
            border-radius: 0 0 5px 5px;
        }
        .tab-panel {
            display: none;
        }
        .tab-panel.active {
            display: block;
        }
        .leaderboard {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        .leaderboard th, .leaderboard td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        .leaderboard th {
            background-color: #3498db;
            color: white;
        }
        .leaderboard tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        .leaderboard tr:hover {
            background-color: #e5e5e5;
        }
        .results-container {
            text-align: center;
            padding: 20px;
        }
        .results-title {
            font-size: 24px;
            margin-bottom: 20px;
            color: #2c3e50;
        }
        .team-results {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 30px;
        }
        .team-result-card {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .team-position {
            font-size: 24px;
            font-weight: bold;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #3498db;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .team-position.first {
            background-color: gold;
            color: #333;
        }
        .team-position.second {
            background-color: silver;
            color: #333;
        }
        .team-position.third {
            background-color: #cd7f32;
            color: white;
        }
        .team-result-name {
            font-weight: bold;
            font-size: 18px;
        }
        .team-result-score {
            font-size: 20px;
            font-weight: bold;
            color: #2c3e50;
        }
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background-color: #f00;
            animation: confetti-fall 5s ease-in-out infinite;
            z-index: 1000;
        }
        @keyframes confetti-fall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }
        .qr-code-display {
            text-align: center;
            margin: 20px 0;
        }
        .qr-code-display img {
            max-width: 250px;
            margin: 0 auto;
        }
        .team-stats {
            display: flex;
            justify-content: space-between;
            margin-top: 5px;
        }
        .team-average {
            font-weight: bold;
            color: #2980b9;
        }
        .print-qr {
            margin-top: 10px;
        }
        @media print {
            body * {
                visibility: hidden;
            }
            .qr-container, .qr-container * {
                visibility: visible;
            }
            .qr-container {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Juego de Estad칤stica para Veterinaria y Zootecnia</h1>

        <!-- Pantalla de inicio de sesi칩n -->
        <div id="login-container" class="login-container active">
            <h2>Iniciar Sesi칩n</h2>
            <div class="input-group">
                <label for="user-type">Seleccione su rol:</label>
                <select id="user-type">
                    <option value="admin">Administrador</option>
                    <option value="student">Estudiante</option>
                </select>
            </div>
            <div id="admin-login-fields">
                <div class="input-group">
                    <label for="admin-password">Contrase침a de administrador:</label>
                    <input type="password" id="admin-password" placeholder="Ingrese la contrase침a">
                </div>
            </div>
            <div id="student-login-fields" style="display: none;">
                <p>Escanea el c칩digo QR proporcionado por tu profesor o ingresa el c칩digo de la sesi칩n:</p>
                <div class="input-group">
                    <label for="session-code">C칩digo de sesi칩n:</label>
                    <input type="text" id="session-code" placeholder="Ingresa el c칩digo de 6 d칤gitos">
                </div>
            </div>
            <div class="buttons">
                <button id="login-btn">Ingresar</button>
            </div>
        </div>

        <!-- Panel de administrador -->
        <div id="admin-panel" class="admin-panel">
            <h2>Panel de Administrador</h2>

            <div class="tab-container">
                <div class="tab-buttons">
                    <button class="tab-button active" data-tab="session-tab">Sesi칩n</button>
                    <button class="tab-button" data-tab="teams-tab">Equipos</button>
                    <button class="tab-button" data-tab="progress-tab">Progreso</button>
                    <button class="tab-button" data-tab="results-tab">Resultados</button>
                </div>

                <div class="tab-content">
                    <!-- Pesta침a de Sesi칩n -->
                    <div id="session-tab" class="tab-panel active">
                        <h3>Informaci칩n de la Sesi칩n</h3>
                        <div class="session-info">
                            <p>C칩digo de sesi칩n: <span id="session-id">Generando...</span></p>
                            <div class="qr-container">
                                <h4>C칩digo QR para acceso de estudiantes</h4>
                                <div id="qrcode"></div>
                                <p>Los estudiantes pueden escanear este c칩digo QR o ingresar el c칩digo de sesi칩n manualmente.</p>
                                <button id="print-qr-btn" class="print-qr">Imprimir C칩digo QR</button>
                            </div>
                            <div class="admin-controls">
                                <h4>Controles de Sesi칩n</h4>
                                <button id="start-session-btn">Iniciar Sesi칩n</button>
                                <button id="pause-session-btn">Pausar Sesi칩n</button>
                                <button id="end-session-btn">Finalizar Sesi칩n</button>
                            </div>
                        </div>
                    </div>

                    <!-- Pesta침a de Equipos -->
                    <div id="teams-tab" class="tab-panel">
                        <h3>Equipos Participantes</h3>
                        <div id="teams-list" class="team-grid">
                            <!-- Los equipos se cargar치n din치micamente aqu칤 -->
                        </div>
                    </div>

                    <!-- Pesta침a de Progreso -->
                    <div id="progress-tab" class="tab-panel">
                        <h3>Progreso de los Equipos</h3>
                        <div id="teams-progress">
                            <!-- El progreso de los equipos se cargar치 din치micamente aqu칤 -->
                        </div>
                    </div>

                    <!-- Pesta침a de Resultados -->
                    <div id="results-tab" class="tab-panel">
                        <h3>Tabla de Clasificaci칩n</h3>
                        <table class="leaderboard">
                            <thead>
                                <tr>
                                    <th>Posici칩n</th>
                                    <th>Equipo</th>
                                    <th>Integrantes</th>
                                    <th>Preguntas</th>
                                    <th>Correctas</th>
                                    <th>Promedio</th>
                                    <th>Puntuaci칩n</th>
                                </tr>
                            </thead>
                            <tbody id="leaderboard-body">
                                <!-- Los resultados se cargar치n din치micamente aqu칤 -->
                            </tbody>
                        </table>
                        <div class="buttons" style="margin-top: 30px;">
                            <button id="show-final-results-btn">Mostrar Resultados Finales</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Selecci칩n de equipo para estudiantes -->
        <div id="team-selection" class="team-selection">
            <h2>Selecciona tu Equipo</h2>
            <div id="student-teams-grid" class="team-grid">
                <!-- Los equipos se cargar치n din치micamente aqu칤 -->
            </div>
            <div class="buttons">
                <button id="join-team-btn" disabled>Unirse al Equipo</button>
            </div>
        </div>

        <!-- Contenedor del juego -->
        <div id="game-container" class="game-container">
            <div class="team-info">
                <h3>Equipo: <span id="current-team-name">-</span></h3>
                <div class="progress">
                    <div class="progress-bar" id="progress"></div>
                </div>
            </div>

            <div id="question-container" class="question">
                <h3 id="question-text">Pregunta aparecer치 aqu칤</h3>
                <div class="image-container" id="question-image-container">
                    <!-- La imagen se insertar치 aqu칤 si es necesario -->
                </div>
                <div class="options" id="options-container">
                    <!-- Las opciones se insertar치n aqu칤 -->
                </div>
                <div class="feedback" id="feedback"></div>
                <div class="explanation" id="explanation"></div>
            </div>

            <div class="buttons">
                <button id="check-btn">Comprobar</button>
                <button id="next-btn" disabled>Siguiente</button>
            </div>

            <div class="result" id="result"></div>
        </div>

        <!-- Pantalla de resultados finales -->
        <div id="results-container" class="results-container">
            <h2 class="results-title">춰Juego Finalizado!</h2>
            <div id="final-results" class="team-results">
                <!-- Los resultados finales se cargar치n din치micamente aqu칤 -->
            </div>
            <div class="buttons">
                <button id="new-game-btn">Nuevo Juego</button>
            </div>
        </div>
    </div>

    <script>
        // Contrase침a de administrador
        const ADMIN_PASSWORD = "admin123";

        // Simulaci칩n de base de datos para el prototipo
        const simulatedDB = {
            sessions: {
                "ABC123": {
                    active: true,
                    startTime: Date.now(),
                    teams: {}
                }
            },
            teams: {
                "team1": { name: "Equipo A", score: 0, questionsAnswered: 0, correctAnswers: 0, members: 0 },
                "team2": { name: "Equipo B", score: 0, questionsAnswered: 0, correctAnswers: 0, members: 0 },
                "team3": { name: "Equipo C", score: 0, questionsAnswered: 0, correctAnswers: 0, members: 0 },
                "team4": { name: "Equipo D", score: 0, questionsAnswered: 0, correctAnswers: 0, members: 0 },
                "team5": { name: "Equipo E", score: 0, questionsAnswered: 0, correctAnswers: 0, members: 0 }
            }
        };

        // Variables globales
        let sessionCode = generateSessionCode();
        let allTeamsFinished = false;
        let gameActive = false;

        // Generar un c칩digo de sesi칩n aleatorio
        function generateSessionCode() {
            const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
            let code = "";
            for (let i = 0; i < 6; i++) {
                code += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return code;
        }

        // Generar c칩digo QR
        function generateQRCode(text) {
            const qr = qrcode(0, 'M');
            qr.addData(text);
            qr.make();
            return qr.createImgTag(5);
        }

        // Preguntas del juego
        const questions = [
            {
                question: "쯈u칠 representa el valor p en un estudio sobre la eficacia de un nuevo antibi칩tico para tratar mastitis en vacas?",
                options: [
                    "La probabilidad de que el antibi칩tico sea efectivo",
                    "La probabilidad de obtener los resultados observados (o m치s extremos) si el antibi칩tico no tiene efecto",
                    "El porcentaje de vacas que se curaron con el antibi칩tico",
                    "El nivel de significancia establecido por el investigador"
                ],
                correctIndex: 1,
                explanation: "El valor p representa la probabilidad de obtener los resultados observados (o m치s extremos) si la hip칩tesis nula fuera cierta. En este caso, si el antibi칩tico realmente no tuviera efecto. Un valor p peque침o sugiere que es poco probable que los resultados se deban al azar.",
                image: "https://cdn.abacus.ai/images/7738cc8a-108f-44e1-a8a0-81ec96bd8772.png"
            },
            {
                question: "En un estudio sobre el efecto de un suplemento alimenticio en el peso de terneros, se obtuvo un valor p de 0.03. 쯈u칠 significa esto?",
                options: [
                    "El suplemento aumenta el peso en un 3%",
                    "Hay un 3% de probabilidad de que el suplemento sea efectivo",
                    "Hay un 3% de probabilidad de obtener estos resultados (o m치s extremos) si el suplemento no tiene efecto",
                    "El 3% de los terneros respondieron al suplemento"
                ],
                correctIndex: 2,
                explanation: "Un valor p de 0.03 significa que hay un 3% de probabilidad de obtener estos resultados (o m치s extremos) si la hip칩tesis nula fuera cierta (si el suplemento no tuviera efecto). Como es menor que el nivel de significancia t칤pico de 0.05, generalmente se considerar칤a estad칤sticamente significativo.",
                image: null
            },
            {
                question: "쯈u칠 es el valor cr칤tico en una prueba de hip칩tesis sobre la eficacia de una vacuna en cerdos?",
                options: [
                    "El n칰mero m칤nimo de cerdos que deben ser vacunados",
                    "El valor que determina el l칤mite entre rechazar o no rechazar la hip칩tesis nula",
                    "El porcentaje m칤nimo de eficacia que debe tener la vacuna",
                    "La dosis m칤nima efectiva de la vacuna"
                ],
                correctIndex: 1,
                explanation: "El valor cr칤tico es el punto de corte en la distribuci칩n de probabilidad que separa la regi칩n de rechazo de la regi칩n de no rechazo de la hip칩tesis nula. Si el estad칤stico de prueba es m치s extremo que el valor cr칤tico, rechazamos la hip칩tesis nula.",
                image: "https://cdn.abacus.ai/images/c2d4ed73-1b0c-4fc9-8878-b9941b16bf3b.png"
            },
            {
                question: "En un estudio sobre dos m칠todos de inseminaci칩n artificial en bovinos, 쯤u칠 significa un valor p = 0.08?",
                options: [
                    "Hay una diferencia significativa entre los dos m칠todos",
                    "No hay una diferencia significativa entre los dos m칠todos (asumiendo 풤 = 0.05)",
                    "El m칠todo nuevo es 8% mejor que el m칠todo tradicional",
                    "Hay un 8% de probabilidad de que ambos m칠todos sean iguales"
                ],
                correctIndex: 1,
                explanation: "Un valor p de 0.08 es mayor que el nivel de significancia t칤pico de 0.05, lo que significa que no rechazamos la hip칩tesis nula. Por lo tanto, no hay evidencia suficiente para afirmar que existe una diferencia significativa entre los dos m칠todos de inseminaci칩n.",
                image: null
            },
            {
                question: "쮺u치l de las siguientes afirmaciones sobre el valor p es INCORRECTA?",
                options: [
                    "Un valor p peque침o indica evidencia contra la hip칩tesis nula",
                    "El valor p es la probabilidad de que la hip칩tesis nula sea verdadera",
                    "El valor p se compara con el nivel de significancia (풤) para tomar decisiones",
                    "Un valor p = 0.01 proporciona mayor evidencia contra la hip칩tesis nula que un valor p = 0.05"
                ],
                correctIndex: 1,
                explanation: "La afirmaci칩n incorrecta es que 'El valor p es la probabilidad de que la hip칩tesis nula sea verdadera'. El valor p NO indica la probabilidad de que la hip칩tesis nula sea verdadera o falsa. Es la probabilidad de obtener los resultados observados (o m치s extremos) si la hip칩tesis nula fuera cierta.",
                image: null
            },
            {
                question: "En un experimento sobre el efecto de un nuevo alimento en el peso de pollos, se obtuvo el siguiente resultado. 쯈u칠 conclusi칩n es correcta?",
                options: [
                    "No hay diferencia significativa entre los dos alimentos",
                    "El nuevo alimento produce un aumento significativo en el peso de los pollos",
                    "El alimento tradicional es mejor que el nuevo",
                    "No se puede determinar sin conocer el valor p"
                ],
                correctIndex: 1,
                explanation: "La imagen muestra una diferencia estad칤sticamente significativa (indicada por el asterisco) entre el grupo control y el grupo con el nuevo alimento. El nuevo alimento produce un aumento significativo en el peso de los pollos.",
                image: "https://cdn.abacus.ai/images/4f3a871a-7027-422d-bcf4-e0d9a1349caf.png"
            },
            {
                question: "Si en un estudio sobre la eficacia de una vacuna contra la fiebre aftosa en bovinos se establece 풤 = 0.01, 쯤u칠 significa esto?",
                options: [
                    "La vacuna debe tener al menos 1% de eficacia",
                    "Se acepta un 1% de probabilidad de concluir incorrectamente que la vacuna es efectiva cuando no lo es",
                    "La vacuna debe funcionar en al menos el 99% de los animales",
                    "El 1% de los animales no responder치 a la vacuna"
                ],
                correctIndex: 1,
                explanation: "El nivel de significancia (풤) representa la probabilidad m치xima que estamos dispuestos a aceptar de cometer un error Tipo I, es decir, rechazar incorrectamente la hip칩tesis nula cuando es verdadera. En este caso, estamos dispuestos a aceptar un 1% de probabilidad de concluir que la vacuna es efectiva cuando en realidad no lo es.",
                image: null
            },
            {
                question: "Observa la siguiente gr치fica sobre el efecto de una vacuna en bovinos. 쯈u칠 conclusi칩n es correcta?",
                options: [
                    "La vacuna no tiene efecto significativo",
                    "La vacuna reduce significativamente la enfermedad",
                    "La vacuna aumenta la enfermedad",
                    "No se puede determinar el efecto sin m치s informaci칩n"
                ],
                correctIndex: 1,
                explanation: "La gr치fica muestra una diferencia estad칤sticamente significativa (p < 0.001, indicado por ***) entre el grupo vacunado y el no vacunado. El porcentaje de animales enfermos es significativamente menor en el grupo vacunado, lo que indica que la vacuna reduce significativamente la enfermedad.",
                image: "https://cdn.abacus.ai/images/80e9d2b8-9112-4bd2-aafc-683ea1a7bd5e.png"
            },
            {
                question: "쮺u치ndo se rechaza la hip칩tesis nula en un estudio sobre el efecto de un suplemento en la producci칩n de leche?",
                options: [
                    "Cuando el valor p es mayor que el nivel de significancia",
                    "Cuando el valor p es menor que el nivel de significancia",
                    "Cuando el valor p es igual a 0.5",
                    "Cuando el estad칤stico de prueba est치 dentro de la regi칩n de aceptaci칩n"
                ],
                correctIndex: 1,
                explanation: "Se rechaza la hip칩tesis nula cuando el valor p es menor que el nivel de significancia (풤) establecido. Esto indica que es poco probable que los resultados observados se deban al azar si la hip칩tesis nula fuera cierta.",
                image: "https://cdn.abacus.ai/images/22d8cb1a-78ad-42de-8027-9d498ba6368a.png"
            },
            {
                question: "En un estudio sobre dos razas de ganado, se obtuvo un valor p = 0.002 al comparar su ganancia diaria de peso. 쯈u칠 significa esto?",
                options: [
                    "Las razas son 0.2% diferentes en su ganancia de peso",
                    "Hay un 0.2% de probabilidad de que las razas sean iguales",
                    "Hay un 0.2% de probabilidad de obtener estos resultados (o m치s extremos) si no hubiera diferencia entre las razas",
                    "La diferencia entre las razas es de 0.002 kg por d칤a"
                ],
                correctIndex: 2,
                explanation: "Un valor p de 0.002 significa que hay un 0.2% de probabilidad de obtener estos resultados (o m치s extremos) si la hip칩tesis nula fuera cierta (si no hubiera diferencia real entre las razas). Este valor p tan peque침o proporciona fuerte evidencia contra la hip칩tesis nula, sugiriendo que realmente existe una diferencia en la ganancia de peso entre las dos razas.",
                image: null
            }
        ];

        // Variables del juego
        let currentQuestionIndex = 0;
        let score = 0;
        let selectedOptionIndex = null;
        let answeredQuestions = 0;
        let currentTeam = null;

        // Elementos del DOM
        const loginContainer = document.getElementById('login-container');
        const adminPanel = document.getElementById('admin-panel');
        const teamSelection = document.getElementById('team-selection');
        const gameContainer = document.getElementById('game-container');
        const resultsContainer = document.getElementById('results-container');

        const userTypeSelect = document.getElementById('user-type');
        const adminLoginFields = document.getElementById('admin-login-fields');
        const studentLoginFields = document.getElementById('student-login-fields');
        const loginBtn = document.getElementById('login-btn');

        const sessionIdElement = document.getElementById('session-id');
        const qrcodeElement = document.getElementById('qrcode');
        const printQrBtn = document.getElementById('print-qr-btn');
        const startSessionBtn = document.getElementById('start-session-btn');
        const pauseSessionBtn = document.getElementById('pause-session-btn');
        const endSessionBtn = document.getElementById('end-session-btn');

        const teamsListElement = document.getElementById('teams-list');
        const studentTeamsGrid = document.getElementById('student-teams-grid');
        const joinTeamBtn = document.getElementById('join-team-btn');

        const teamsProgressElement = document.getElementById('teams-progress');
        const leaderboardBody = document.getElementById('leaderboard-body');
        const showFinalResultsBtn = document.getElementById('show-final-results-btn');

        const currentTeamNameElement = document.getElementById('current-team-name');
        const questionText = document.getElementById('question-text');
        const questionImageContainer = document.getElementById('question-image-container');
        const optionsContainer = document.getElementById('options-container');
        const feedbackElement = document.getElementById('feedback');
        const explanationElement = document.getElementById('explanation');
        const checkButton = document.getElementById('check-btn');
        const nextButton = document.getElementById('next-btn');
        const resultElement = document.getElementById('result');
        const progressBar = document.getElementById('progress');

        const finalResultsElement = document.getElementById('final-results');
        const newGameBtn = document.getElementById('new-game-btn');

        // Cambiar entre tipos de usuario
        userTypeSelect.addEventListener('change', function() {
            if (this.value === 'admin') {
                adminLoginFields.style.display = 'block';
                studentLoginFields.style.display = 'none';
            } else {
                adminLoginFields.style.display = 'none';
                studentLoginFields.style.display = 'block';
            }
        });

        // Iniciar sesi칩n
        loginBtn.addEventListener('click', function() {
            const userType = userTypeSelect.value;

            if (userType === 'admin') {
                const password = document.getElementById('admin-password').value;

                if (password === ADMIN_PASSWORD) {
                    loginContainer.classList.remove('active');
                    adminPanel.classList.add('active');

                    // Mostrar c칩digo de sesi칩n y QR
                    sessionIdElement.textContent = sessionCode;
                    const gameUrl = window.location.href.split('?')[0] + '?session=' + sessionCode;
                    qrcodeElement.innerHTML = generateQRCode(gameUrl);

                    // Cargar equipos
                    loadTeams();
                    updateLeaderboard();
                } else {
                    alert('Contrase침a incorrecta. Int칠ntelo de nuevo.');
                }

            } else {
                const code = document.getElementById('session-code').value;

                // En un sistema real, aqu칤 se verificar칤a el c칩digo de sesi칩n
                // Para el prototipo, simplemente permitimos el acceso
                loginContainer.classList.remove('active');
                teamSelection.classList.add('active');

                // Cargar equipos para selecci칩n
                loadTeamsForSelection();
            }
        });

        // Imprimir c칩digo QR
        printQrBtn.addEventListener('click', function() {
            window.print();
        });

        // Cambiar entre pesta침as del panel de administrador
        document.querySelectorAll('.tab-button').forEach(button => {
            button.addEventListener('click', function() {
                // Desactivar todas las pesta침as
                document.querySelectorAll('.tab-button').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.querySelectorAll('.tab-panel').forEach(panel => {
                    panel.classList.remove('active');
                });

                // Activar la pesta침a seleccionada
                this.classList.add('active');
                const tabId = this.getAttribute('data-tab');
                document.getElementById(tabId).classList.add('active');

                // Actualizar contenido de la pesta침a
                if (tabId === 'progress-tab') {
                    updateTeamsProgress();
                } else if (tabId === 'results-tab') {
                    updateLeaderboard();
                }
            });
        });

        // Unirse a un equipo
        joinTeamBtn.addEventListener('click', function() {
            teamSelection.classList.remove('active');
            gameContainer.classList.add('active');

            // Incrementar el contador de miembros del equipo
            simulatedDB.teams[currentTeam].members++;

            currentTeamNameElement.textContent = simulatedDB.teams[currentTeam].name;
            startGame();
        });

        // Calcular promedio del equipo
        function calculateTeamAverage(team) {
            if (team.members === 0 || team.questionsAnswered === 0) return 0;

            // Promedio de respuestas correctas por miembro
            return (team.correctAnswers / team.members).toFixed(2);
        }

        // Cargar equipos para el panel de administrador
        function loadTeams() {
            teamsListElement.innerHTML = '';

            for (const teamId in simulatedDB.teams) {
                const team = simulatedDB.teams[teamId];
                const average = calculateTeamAverage(team);

                const teamCard = document.createElement('div');
                teamCard.className = 'team-card';
                teamCard.innerHTML = `
                    <div class="team-name">${team.name}</div>
                    <div class="team-stats">
                        <div>Integrantes: ${team.members}</div>
                        <div class="team-average">Promedio: ${average}</div>
                    </div>
                    <div class="team-score">Puntuaci칩n: ${team.score}</div>
                `;

                teamsListElement.appendChild(teamCard);
            }
        }

        // Cargar equipos para selecci칩n de estudiantes
        function loadTeamsForSelection() {
            studentTeamsGrid.innerHTML = '';

            for (const teamId in simulatedDB.teams) {
                const team = simulatedDB.teams[teamId];

                const teamCard = document.createElement('div');
                teamCard.className = 'team-card';
                teamCard.setAttribute('data-team-id', teamId);
                teamCard.innerHTML = `
                    <div class="team-name">${team.name}</div>
                    <div>Integrantes: ${team.members}</div>
                `;

                teamCard.addEventListener('click', function() {
                    // Desmarcar todos los equipos
                    document.querySelectorAll('.team-card').forEach(card => {
                        card.classList.remove('selected-team');
                    });

                    // Marcar el equipo seleccionado
                    this.classList.add('selected-team');
                    currentTeam = this.getAttribute('data-team-id');

                    // Habilitar bot칩n de unirse
                    joinTeamBtn.disabled = false;
                });

                studentTeamsGrid.appendChild(teamCard);
            }
        }

        // Actualizar progreso de los equipos
        function updateTeamsProgress() {
            teamsProgressElement.innerHTML = '';

            for (const teamId in simulatedDB.teams) {
                const team = simulatedDB.teams[teamId];
                const progress = team.questionsAnswered / questions.length * 100;
                const average = calculateTeamAverage(team);

                const teamProgressElement = document.createElement('div');
                teamProgressElement.className = 'team-progress';
                teamProgressElement.innerHTML = `
                    <div class="team-name">${team.name}</div>
                    <div class="team-stats">
                        <div>Integrantes: ${team.members}</div>
                        <div class="team-average">Promedio: ${average}</div>
                    </div>
                    <div>Preguntas respondidas: ${team.questionsAnswered} de ${questions.length}</div>
                    <div>Respuestas correctas: ${team.correctAnswers}</div>
                    <div class="progress">
                        <div class="progress-bar" style="width: ${progress}%"></div>
                    </div>
                `;

                teamsProgressElement.appendChild(teamProgressElement);
            }

            // Verificar si todos los equipos han terminado
            checkAllTeamsFinished();
        }

        // Verificar si todos los equipos han terminado
        function checkAllTeamsFinished() {
            if (allTeamsFinished) return;

            let allFinished = true;
            let activeTeams = 0;

            for (const teamId in simulatedDB.teams) {
                const team = simulatedDB.teams[teamId];
                if (team.members > 0) {
                    activeTeams++;
                    if (team.questionsAnswered < questions.length) {
                        allFinished = false;
                    }
                }
            }

            // Si no hay equipos activos, no hacemos nada
            if (activeTeams === 0) return;

            // Si todos los equipos activos han terminado, mostrar resultados
            if (allFinished) {
                allTeamsFinished = true;
                showFinalResults();
            }
        }

        // Actualizar tabla de clasificaci칩n
        function updateLeaderboard() {
            // Ordenar equipos por puntuaci칩n
            const sortedTeams = Object.entries(simulatedDB.teams)
                .map(([id, team]) => ({ id, ...team }))
                .sort((a, b) => b.score - a.score);

            leaderboardBody.innerHTML = '';

            sortedTeams.forEach((team, index) => {
                const average = calculateTeamAverage(team);

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${team.name}</td>
                    <td>${team.members}</td>
                    <td>${team.questionsAnswered}</td>
                    <td>${team.correctAnswers}</td>
                    <td>${average}</td>
                    <td>${team.score}</td>
                `;

                leaderboardBody.appendChild(row);
            });
        }

        // Iniciar el juego
        function startGame() {
            gameActive = true;
            currentQuestionIndex = 0;
            score = 0;
            answeredQuestions = 0;
            loadQuestion();
        }

        // Cargar pregunta actual
        function loadQuestion() {
            const currentQuestion = questions[currentQuestionIndex];

            // Actualizar texto de la pregunta
            questionText.textContent = currentQuestion.question;

            // Limpiar opciones anteriores
            optionsContainer.innerHTML = '';

            // Cargar imagen si existe
            if (currentQuestion.image) {
                questionImageContainer.innerHTML = `<img src="${currentQuestion.image}" alt="Imagen de la pregunta">`;
                questionImageContainer.style.display = 'block';
            } else {
                questionImageContainer.style.display = 'none';
            }

            // Crear opciones
            currentQuestion.options.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.className = 'option';
                optionElement.textContent = option;
                optionElement.dataset.index = index;

                optionElement.addEventListener('click', () => {
                    // Desmarcar opci칩n previamente seleccionada
                    document.querySelectorAll('.option').forEach(opt => {
                        opt.classList.remove('selected');
                    });

                    // Marcar nueva opci칩n seleccionada
                    optionElement.classList.add('selected');
                    selectedOptionIndex = index;

                    // Habilitar bot칩n de comprobar
                    checkButton.disabled = false;
                });

                optionsContainer.appendChild(optionElement);
            });

            // Reiniciar estado
            selectedOptionIndex = null;
            feedbackElement.style.display = 'none';
            explanationElement.style.display = 'none';
            checkButton.disabled = true;
            nextButton.disabled = true;

            // Actualizar barra de progreso
            updateProgressBar();
        }

        // Comprobar respuesta
        function checkAnswer() {
            const currentQuestion = questions[currentQuestionIndex];
            const options = document.querySelectorAll('.option');

            // Marcar respuesta correcta e incorrecta
            options.forEach((option, index) => {
                if (index === currentQuestion.correctIndex) {
                    option.classList.add('correct');
                } else if (index === selectedOptionIndex) {
                    option.classList.add('incorrect');
                }
            });

            // Mostrar retroalimentaci칩n
            if (selectedOptionIndex === currentQuestion.correctIndex) {
                feedbackElement.textContent = '춰Correcto! 游녨';
                feedbackElement.style.backgroundColor = '#2ecc71';
                score++;

                // Actualizar puntuaci칩n del equipo
                if (currentTeam) {
                    simulatedDB.teams[currentTeam].score += 10;
                    simulatedDB.teams[currentTeam].correctAnswers++;
                }
            } else {
                feedbackElement.textContent = '춰Incorrecto! La respuesta correcta est치 marcada en verde.';
                feedbackElement.style.backgroundColor = '#e74c3c';
            }

            // Mostrar explicaci칩n
            explanationElement.textContent = currentQuestion.explanation;

            // Mostrar elementos
            feedbackElement.style.display = 'block';
            explanationElement.style.display = 'block';

            // Actualizar botones
            checkButton.disabled = true;
            nextButton.disabled = false;

            // Actualizar contador de preguntas respondidas
            answeredQuestions++;

            // Actualizar estad칤sticas del equipo
            if (currentTeam) {
                simulatedDB.teams[currentTeam].questionsAnswered++;

                // En un sistema real, aqu칤 se sincronizar칤a con Firebase
                updateTeamsProgress();
                updateLeaderboard();
            }

            // Verificar si es la 칰ltima pregunta
            if (currentQuestionIndex === questions.length - 1) {
                nextButton.textContent = 'Ver Resultado';
            }
        }

        // Pasar a la siguiente pregunta
        function nextQuestion() {
            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                loadQuestion();
            } else {
                showResult();
            }
        }

        // Mostrar resultado final
        function showResult() {
            const percentage = Math.round((score / questions.length) * 100);

            // Ocultar contenedor de preguntas
            document.getElementById('question-container').style.display = 'none';

            // Mostrar resultado
            resultElement.innerHTML = `
                <h2>Resultado Final</h2>
                <p>Tu equipo ha acertado ${score} de ${questions.length} preguntas (${percentage}%)</p>
                <button id="exit-btn">Volver al Inicio</button>
            `;

            // Ocultar botones
            document.querySelector('.buttons').style.display = 'none';

            // Evento para salir
            document.getElementById('exit-btn').addEventListener('click', () => {
                gameContainer.classList.remove('active');
                loginContainer.classList.add('active');

                // Limpiar resultado
                resultElement.innerHTML = '';

                // Mostrar contenedor de preguntas para la pr칩xima vez
                document.getElementById('question-container').style.display = 'block';

                // Mostrar botones para la pr칩xima vez
                document.querySelector('.buttons').style.display = 'block';

                // Reiniciar bot칩n de siguiente
                nextButton.textContent = 'Siguiente';
            });
        }

        // Actualizar barra de progreso
        function updateProgressBar() {
            const progress = ((currentQuestionIndex) / questions.length) * 100;
            progressBar.style.width = `${progress}%`;
        }

        // Mostrar resultados finales
        function showFinalResults() {
            // Ordenar equipos por puntuaci칩n
            const sortedTeams = Object.entries(simulatedDB.teams)
                .filter(([_, team]) => team.members > 0) // Solo equipos con miembros
                .map(([id, team]) => ({ id, ...team }))
                .sort((a, b) => b.score - a.score);

            finalResultsElement.innerHTML = '';

            sortedTeams.forEach((team, index) => {
                const positionClass = index === 0 ? 'first' : (index === 1 ? 'second' : (index === 2 ? 'third' : ''));
                const average = calculateTeamAverage(team);

                const teamResultCard = document.createElement('div');
                teamResultCard.className = 'team-result-card';
                teamResultCard.innerHTML = `
                    <div class="team-position ${positionClass}">${index + 1}</div>
                    <div class="team-result-name">${team.name}</div>
                    <div class="team-result-details">
                        <div>Integrantes: ${team.members}</div>
                        <div>Preguntas: ${team.questionsAnswered}/${questions.length}</div>
                        <div>Correctas: ${team.correctAnswers}</div>
                        <div>Promedio: ${average}</div>
                    </div>
                    <div class="team-result-score">${team.score} pts</div>
                `;

                finalResultsElement.appendChild(teamResultCard);
            });

            // Mostrar pantalla de resultados
            if (gameActive) {
                hideAllScreens();
                resultsContainer.classList.add('active');
                createConfetti();
            }
        }

        // Crear efecto de confeti
        function createConfetti() {
            const colors = ['#f44336', '#e91e63', '#9c27b0', '#673ab7', '#3f51b5', '#2196f3', '#03a9f4', '#00bcd4', '#009688', '#4CAF50', '#8BC34A', '#CDDC39', '#FFEB3B', '#FFC107', '#FF9800', '#FF5722'];

            for (let i = 0; i < 100; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.width = Math.random() * 10 + 5 + 'px';
                confetti.style.height = Math.random() * 10 + 5 + 'px';
                confetti.style.animationDuration = Math.random() * 3 + 2 + 's';
                confetti.style.animationDelay = Math.random() * 5 + 's';

                document.body.appendChild(confetti);

                // Eliminar confeti despu칠s de la animaci칩n
                setTimeout(() => {
                    confetti.remove();
                }, 8000);
            }
        }

        // Ocultar todas las pantallas
        function hideAllScreens() {
            loginContainer.classList.remove('active');
            adminPanel.classList.remove('active');
            teamSelection.classList.remove('active');
            gameContainer.classList.remove('active');
            resultsContainer.classList.remove('active');
        }

        // Eventos de los botones del juego
        checkButton.addEventListener('click', checkAnswer);
        nextButton.addEventListener('click', nextQuestion);

        // Eventos de los botones de sesi칩n
        startSessionBtn.addEventListener('click', function() {
            gameActive = true;
            alert('Sesi칩n iniciada. Los estudiantes pueden unirse ahora.');
        });

        pauseSessionBtn.addEventListener('click', function() {
            alert('Sesi칩n pausada. Los estudiantes no podr치n avanzar hasta que se reanude.');
        });

        endSessionBtn.addEventListener('click', function() {
            if (confirm('쮼st치s seguro de finalizar la sesi칩n? Esto mostrar치 los resultados finales.')) {
                gameActive = false;
                showFinalResults();
            }
        });

        // Mostrar resultados finales (bot칩n en panel de administrador)
        showFinalResultsBtn.addEventListener('click', function() {
            if (confirm('쮼st치s seguro de mostrar los resultados finales? Esto finalizar치 el juego para todos los equipos.')) {
                gameActive = false;
                showFinalResults();
            }
        });

        // Nuevo juego
        newGameBtn.addEventListener('click', function() {
            // Reiniciar estad칤sticas de equipos
            for (const teamId in simulatedDB.teams) {
                simulatedDB.teams[teamId].score = 0;
                simulatedDB.teams[teamId].questionsAnswered = 0;
                simulatedDB.teams[teamId].correctAnswers = 0;
            }

            // Generar nuevo c칩digo de sesi칩n
            sessionCode = generateSessionCode();
            sessionIdElement.textContent = sessionCode;
            const gameUrl = window.location.href.split('?')[0] + '?session=' + sessionCode;
            qrcodeElement.innerHTML = generateQRCode(gameUrl);

            // Reiniciar variables
            allTeamsFinished = false;
            gameActive = true;

            // Actualizar interfaz
            loadTeams();
            updateLeaderboard();
            updateTeamsProgress();

            // Volver al panel de administrador
            hideAllScreens();
            adminPanel.classList.add('active');
        });

        // Verificar si hay un c칩digo de sesi칩n en la URL (para estudiantes que acceden por QR)
        const urlParams = new URLSearchParams(window.location.search);
        const sessionFromUrl = urlParams.get('session');

        if (sessionFromUrl) {
            userTypeSelect.value = 'student';
            userTypeSelect.dispatchEvent(new Event('change'));
            document.getElementById('session-code').value = sessionFromUrl;
        }
    </script>
</body>
</html>
